<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Space Shooter</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">

<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>

<style>
body {
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background-color: #0a0a1a;
  font-family: 'Orbitron', sans-serif;
  color: #fff;
  overflow: hidden;
}

#game-container { text-align: center; }

canvas {
  background-color: #000;
  border-radius: 10px;
  box-shadow: 0 0 20px rgba(0,255,255,0.5);
  display: block;
}

h1 {
  color: #00ffff;
  text-shadow: 0 0 10px #00ffff;
}
</style>
</head>

<body>
<div id="game-container">
<h1>Space Shooter</h1>
<canvas id="gameCanvas" width="1200" height="900"></canvas>
</div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

const collisionSound = new Tone.Synth({
  oscillator: { type: "fmsquare" },
  envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.1 }
}).toDestination();

let score = 0;
let gameOver = false;
let gameStarted = false;
const keys = {};

class Player {
  constructor() {
    this.width = 64;
    this.height = 64;
    this.x = canvas.width/2 - this.width/2;
    this.y = canvas.height - this.height - 40;
    this.speed = 10;
    this.bullets = [];
    this.shootCooldown = 0;
    this.maxFuel = 100;
    this.fuel = 100;
    this.shieldActive = false;
    this.shieldTimer = 0;
  }

  update() {
    if(keys["ArrowLeft"] && this.x > 0) this.x -= this.speed;
    if(keys["ArrowRight"] && this.x < canvas.width-this.width) this.x += this.speed;
    if(keys["ArrowUp"] && this.y > 0) this.y -= this.speed;
    if(keys["ArrowDown"] && this.y < canvas.height-this.height) this.y += this.speed;

    if(keys[" "] && this.shootCooldown <= 0) {
      this.shoot();
      this.shootCooldown = 15;
    }

    if(this.shootCooldown > 0) this.shootCooldown--;

    this.bullets.forEach((b,i)=>{
      b.update();
      if(b.y < 0) this.bullets.splice(i,1);
    });

    // Slower fuel drain
    this.fuel -= 0.03;
    if(this.fuel <= 0) gameOver = true;

    if(this.shieldActive){
      this.shieldTimer--;
      if(this.shieldTimer <= 0) this.shieldActive = false;
    }
  }

  draw(){
    // Draw spaceship as a triangle
    ctx.save();
    ctx.fillStyle = "#00ffff";
    ctx.beginPath();
    ctx.moveTo(this.x + this.width/2, this.y); // Top point
    ctx.lineTo(this.x, this.y + this.height); // Bottom left
    ctx.lineTo(this.x + this.width, this.y + this.height); // Bottom right
    ctx.closePath();
    ctx.fill();
    
    // Add outline
    ctx.strokeStyle = "#00ff00";
    ctx.lineWidth = 2;
    ctx.stroke();
    
    ctx.restore();

    if(this.shieldActive){
      ctx.beginPath();
      ctx.arc(this.x+this.width/2,this.y+this.height/2,this.width/2+10,0,Math.PI*2);
      ctx.fillStyle="rgba(0,255,255,0.3)";
      ctx.fill();
      ctx.strokeStyle="cyan";
      ctx.stroke();
    }

    this.bullets.forEach(b=>b.draw());
  }

  shoot(){ this.bullets.push(new Bullet(this.x+this.width/2,this.y)); }
  activateShield(){ this.shieldActive=true; this.shieldTimer=300; }
  addFuel(){ this.fuel=Math.min(this.maxFuel,this.fuel+40); }
}

class Bullet{
  constructor(x,y){ this.width=8; this.height=16; this.x=x-4; this.y=y; this.speed=20; }
  update(){ this.y-=this.speed; }
  draw(){ 
    ctx.fillStyle = "#ffff00";
    ctx.fillRect(this.x, this.y, this.width, this.height);
    ctx.strokeStyle = "#ff00ff";
    ctx.lineWidth = 1;
    ctx.strokeRect(this.x, this.y, this.width, this.height);
  }
}

class Competitor{
  constructor(type,w,h,s){
    this.type=type; this.width=w; this.height=h;
    this.x=Math.random()*(canvas.width-w);
    this.y=-h; this.speed=s;
  }
  update(){ this.y+=this.speed; }
  draw(){ 
    ctx.save();
    ctx.translate(this.x + this.width/2, this.y + this.height/2);
    
    if(this.type === "asteroid") {
      // Draw jagged asteroid
      ctx.fillStyle = "#ff6600";
      ctx.beginPath();
      for(let i = 0; i < 8; i++) {
        const angle = (i / 8) * Math.PI * 2;
        const radius = 20 + Math.random() * 10;
        const x = Math.cos(angle) * radius;
        const y = Math.sin(angle) * radius;
        if(i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.closePath();
      ctx.fill();
      ctx.strokeStyle = "#ffaa00";
      ctx.lineWidth = 2;
      ctx.stroke();
    }
    
    ctx.restore();
  }
}

class Asteroid extends Competitor{
  constructor(){ super("asteroid",64,64,Math.random()*2+2); }
}
class Chaser extends Competitor{
  constructor(){ super("chaser",50,50,2); }
  update(){ super.update(); if(player.x>this.x) this.x+=1; else this.x-=1; }
  draw(){
    // Draw enemy ship as inverted triangle (moving down)
    ctx.save();
    ctx.fillStyle = "#ff8800";
    ctx.beginPath();
    ctx.moveTo(this.x + this.width/2, this.y + this.height); // Bottom point
    ctx.lineTo(this.x, this.y); // Top left
    ctx.lineTo(this.x + this.width, this.y); // Top right
    ctx.closePath();
    ctx.fill();
    ctx.strokeStyle = "#ffaa00";
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.restore();
  }
}
class Dodger extends Competitor{
  constructor(){ super("dodger",50,50,4); }
  draw(){
    // Draw dodger as a diamond/rhombus shape
    ctx.save();
    ctx.fillStyle = "#ff00ff";
    ctx.beginPath();
    ctx.moveTo(this.x + this.width/2, this.y); // Top
    ctx.lineTo(this.x + this.width, this.y + this.height/2); // Right
    ctx.lineTo(this.x + this.width/2, this.y + this.height); // Bottom
    ctx.lineTo(this.x, this.y + this.height/2); // Left
    ctx.closePath();
    ctx.fill();
    ctx.strokeStyle = "#ff0099";
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.restore();
  }
}

class PowerUp{
  constructor(type){
    this.type=type; this.width=40; this.height=40;
    this.x=Math.random()*(canvas.width-40);
    this.y=-40; this.speed=2;
  }
  update(){ this.y+=this.speed; }
  draw(){ }
}

class ShieldPowerUp extends PowerUp{
  constructor(){ super("shield"); }
  draw(){
    // Draw shield as a circle with cross
    ctx.save();
    ctx.fillStyle = "rgba(0,255,0,0.6)";
    ctx.beginPath();
    ctx.arc(this.x + this.width/2, this.y + this.height/2, 20, 0, Math.PI*2);
    ctx.fill();
    ctx.strokeStyle = "#00ff00";
    ctx.lineWidth = 3;
    ctx.stroke();
    
    // Draw cross in the middle
    ctx.strokeStyle = "#00ff00";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(this.x + this.width/2 - 8, this.y + this.height/2);
    ctx.lineTo(this.x + this.width/2 + 8, this.y + this.height/2);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(this.x + this.width/2, this.y + this.height/2 - 8);
    ctx.lineTo(this.x + this.width/2, this.y + this.height/2 + 8);
    ctx.stroke();
    ctx.restore();
  }
}
class FuelPowerUp extends PowerUp{
  constructor(){ super("fuel"); }
  draw(){
    // Draw fuel as a star
    ctx.save();
    ctx.fillStyle = "rgba(255,255,255,0.8)";
    const cx = this.x + this.width/2;
    const cy = this.y + this.height/2;
    const spikes = 5;
    const outerRadius = 18;
    const innerRadius = 8;
    
    ctx.beginPath();
    for(let i = 0; i < spikes * 2; i++) {
      const radius = i % 2 === 0 ? outerRadius : innerRadius;
      const angle = (i / (spikes * 2)) * Math.PI * 2 - Math.PI/2;
      const x = cx + Math.cos(angle) * radius;
      const y = cy + Math.sin(angle) * radius;
      if(i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    }
    ctx.closePath();
    ctx.fill();
    ctx.strokeStyle = "#ffff00";
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.restore();
  }
}

let player=new Player();
let competitors=[];
let powerUps=[];
let spawnTimer=100;
let powerTimer=300; // Faster power-up spawn

function resetGame(){
  player=new Player();
  competitors=[];
  powerUps=[];
  score=0;
  gameOver=false;
  gameStarted=true;
  requestAnimationFrame(gameLoop);
}

function checkCollisions(){
  player.bullets.forEach((b,bi)=>{
    competitors.forEach((c,ci)=>{
      if(b.x<c.x+c.width && b.x+b.width>c.x &&
         b.y<c.y+c.height && b.y+b.height>c.y){
           competitors.splice(ci,1);
           player.bullets.splice(bi,1);
           score+=10;
      }
    });
  });

  if(!player.shieldActive){
    competitors.forEach(c=>{
      if(player.x<c.x+c.width && player.x+player.width>c.x &&
         player.y<c.y+c.height && player.y+player.height>c.y){
           collisionSound.triggerAttackRelease("C2","8n");
           gameOver=true;
      }
    });
  }

  powerUps.forEach((p,pi)=>{
    if(player.x<p.x+p.width && player.x+player.width>p.x &&
       player.y<p.y+p.height && player.y+player.height>p.y){
         powerUps.splice(pi,1);
         if(p instanceof ShieldPowerUp) player.activateShield();
         if(p instanceof FuelPowerUp) player.addFuel();
    }
  });
}

function spawn(){
  spawnTimer--;
  if(spawnTimer<=0){
    const r=Math.random();
    if(r<0.6) competitors.push(new Asteroid());
    else if(r<0.85) competitors.push(new Chaser());
    else competitors.push(new Dodger());
    spawnTimer=100;
  }

  powerTimer--;
  if(powerTimer<=0){

    // Adaptive fuel logic
    let fuelChance = 5.0; // Base 70%
    if(player.fuel < 30) fuelChance = 0.9;
    if(player.fuel < 15) fuelChance = 1.0;

    if(Math.random() < fuelChance)
      powerUps.push(new FuelPowerUp());
    else
      powerUps.push(new ShieldPowerUp());

    powerTimer=300;
  }
}

function drawUI(){
  ctx.save();
  ctx.textAlign="left";
  ctx.textBaseline="top";

  ctx.fillStyle="white";
  ctx.font="24px Orbitron";
  ctx.fillText("Score: "+score,20,20);

  ctx.fillStyle="#555";
  ctx.fillRect(canvas.width-220,20,200,30);

  ctx.fillStyle=player.fuel<25?"red":"lime";
  ctx.fillRect(canvas.width-220,20,(player.fuel/player.maxFuel)*200,30);

  ctx.strokeStyle="white";
  ctx.strokeRect(canvas.width-220,20,200,30);

  ctx.restore();
}

function drawStart(){
  ctx.fillStyle="white";
  ctx.textAlign="center";
  ctx.font="40px Orbitron";
  ctx.fillText("Click To Start",canvas.width/2,canvas.height/2);
}

function drawGameOver(){
  ctx.fillStyle="rgba(0,0,0,0.7)";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="red";
  ctx.font="60px Orbitron";
  ctx.textAlign="center";
  ctx.fillText("GAME OVER",canvas.width/2,canvas.height/2);
}

function gameLoop(){
  if(!gameStarted){ drawStart(); return; }
  if(gameOver){ drawGameOver(); return; }

  ctx.clearRect(0,0,canvas.width,canvas.height);

  player.update();
  competitors.forEach((c,i)=>{
    c.update();
    if(c.y>canvas.height) competitors.splice(i,1);
  });
  powerUps.forEach((p,i)=>{
    p.update();
    if(p.y>canvas.height) powerUps.splice(i,1);
  });

  spawn();
  checkCollisions();

  player.draw();
  competitors.forEach(c=>c.draw());
  powerUps.forEach(p=>p.draw());
  drawUI();

  requestAnimationFrame(gameLoop);
}

window.addEventListener("keydown",e=>keys[e.key]=true);
window.addEventListener("keyup",e=>keys[e.key]=false);

canvas.addEventListener("click",()=>{
  if(Tone.context.state!=="running") Tone.start();
  if(!gameStarted||gameOver) resetGame();
});

drawStart();
</script>
</body>
</html>
